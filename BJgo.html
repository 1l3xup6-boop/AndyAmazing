<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ‚¡ 21 é»æœ€å„ªç­–ç•¥ï¼ˆä¾å‰©é¤˜ç‰Œçµ„ Â· æ‰‹æ©Ÿç‰ˆï¼‰</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0f172a; --border:#22314f; --text:#e5e7eb; --muted:#9aa7bd;
    --accent:#22d3ee; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(900px 600px at 30% -20%, #18234a 0%, var(--bg) 60%) fixed;color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans TC,"PingFang TC","Microsoft JhengHei",Arial;font-size:14px}
  .wrap{max-width:780px;margin:0 auto;padding:8px}
  h1{margin:0 0 6px 0;font-size:18px;line-height:1.2}
  .sub{color:var(--muted);margin-bottom:8px;font-size:11px;line-height:1.3}
  .panel{background:rgba(15,23,42,.88);backdrop-filter:blur(6px);border:1px solid rgba(146,163,184,.25);border-radius:12px;padding:10px}
  label{font-size:11px;color:var(--muted);letter-spacing:.06em;text-transform:uppercase}
  input,select,button{background:#0b1228;color:var(--text);border:1px solid rgba(146,163,184,.3);border-radius:10px;padding:8px 10px;font-size:14px}
  button{cursor:pointer}
  .row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
  .cards{display:flex;gap:6px;flex-wrap:wrap}
  .rank{padding:8px 10px;border:1px dashed rgba(146,163,184,.35);border-radius:10px;min-width:50px;min-height:36px;display:flex;flex-direction:column;align-items:center;justify-content:center;touch-action:manipulation;font-size:14px}
  .rank:active{transform:scale(.97)}
  .count{font-size:11px;color:var(--muted)}
  .hand{display:flex;gap:6px;flex-wrap:wrap}
  .card{width:50px;height:70px;border-radius:10px;border:1px solid rgba(146,163,184,.35);display:grid;place-items:center;background:linear-gradient(180deg,#0f1a39,#0c1429);font-weight:700;font-size:14px}
  .ghost{opacity:.6;font-style:italic;font-size:13px}
  .actions{display:flex;gap:6px;flex-direction:column;margin-top:6px}
  .act{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);font-weight:700;display:flex;justify-content:space-between;align-items:center;font-size:13px}
  .HIT{border-color:#6366f1;background:rgba(99,102,241,0.1)}
  .STAND{border-color:#16a34a;background:rgba(22,163,74,0.1)}
  .DOUBLE{border-color:#3b82f6;background:rgba(59,130,246,0.1)}
  .SPLIT{border-color:#f59e0b;background:rgba(245,158,11,0.1)}
  .SURRENDER{border-color:#ef4444;background:rgba(239,68,68,0.1)}
  .BUST{border-color:#ef4444;background:rgba(239,68,68,0.1)}
  .ev{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
  .bar{height:8px;background:#0b1228;border:1px solid rgba(146,163,184,.25);border-radius:999px;overflow:hidden;width:100%}
  .fill{height:100%;background:linear-gradient(90deg,#06b6d4,#22d3ee)}
  .footer{color:var(--muted);text-align:center;margin:8px 0 4px 0;font-size:10px}
  .stack{display:grid;gap:8px}
  .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
  .kpis > div{background:#0b1228;border:1px solid rgba(146,163,184,.25);border-radius:10px;padding:8px;text-align:center;font-size:12px}
  .sticky-bottom{position:sticky;bottom:8px;z-index:1}
  .btn-small{padding:6px 8px;font-size:12px;border-radius:8px}
  #tcDisplay{font-size:12px;margin-top:4px;font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ‚¡ 21 é»æœ€å„ªç­–ç•¥ï¼ˆä¾å‰©é¤˜ç‰Œçµ„ Â· æ‰‹æ©Ÿç‰ˆï¼‰</h1>
  <div class="sub">é»ç‰Œè¨˜éŒ„ â†’ è¨­å®šèŠå®¶/ç©å®¶ â†’ å³æ™‚çµ¦å‡ºæœ€å„ªå‹•ä½œã€‚é»ä¸€ä¸‹ +1ï¼Œé•·æŒ‰ -1ï¼ˆèª¤è§¸å¯æŒ‰ã€Œæ’¤éŠ·å·²å‡ºç‰Œã€ï¼‰ã€‚</div>

  <div class="panel stack">
    <div class="row">
      <div>
        <label>ç‰Œé´å‰¯æ•¸</label><br />
        <input type="number" id="decks" min="1" max="12" value="6" style="width:100px"/>
      </div>
      <div>
        <label>èŠå®¶è»Ÿ17</label><br/>
        <select id="s17">
          <option value="H17">è£œç‰Œ (H17)</option>
          <option value="S17" selected>åœç‰Œ (S17)</option>
        </select>
      </div>
      <div>
        <label>åˆ†ç‰Œå¾ŒåŠ å€</label><br/>
        <select id="das">
          <option value="DAS" selected>å…è¨±</option>
          <option value="NDAS">ç¦æ­¢</option>
        </select>
      </div>
      <div>
        <label>æ™šæŠ•é™</label><br/>
        <select id="surrender">
          <option value="LS" selected>å¯</option>
          <option value="NS">ä¸å¯</option>
        </select>
      </div>
      <div>
        <label>æ¨£æœ¬æ•¸</label><br/>
        <input type="number" id="samples" min="500" max="30000" step="500" value="3000" style="width:110px"/>
      </div>
      <div class="row" style="margin-top:4px">
        <button class="btn-small" id="reset">é‡è¨­</button>
        <button class="btn-small" id="undoSeen">æ’¤éŠ·å·²å‡ºç‰Œ</button>
      </div>
    </div>

    <div>
      <label>ç´€éŒ„å·²å‡ºç¾çš„ç‰Œï¼ˆé»ä¸€ä¸‹ +1ï¼›é•·æŒ‰ -1ï¼‰</label>
      <div id="seenBtns" class="cards" style="margin-top:6px"></div>
      <div class="kpis" id="shoeKpis" style="margin-top:6px">
        <div>
          <div class="count">å‰©é¤˜ç‰Œæ•¸</div>
          <div id="leftCnt" style="font-weight:800;font-size:16px">â€”</div>
        </div>
        <div>
          <div class="count">å‰©é¤˜é«˜ç‰Œ</div>
          <div id="hiCnt" style="font-weight:800;font-size:16px">â€”</div>
        </div>
      </div>
    </div>

    <div class="row" style="gap:12px">
      <div style="flex:1">
        <label>èŠå®¶æ˜ç‰Œ</label>
        <div id="dealerBtns" class="cards" style="margin-top:6px"></div>
        <div id="dealerView" class="hand" style="margin-top:6px"></div>
      </div>
      <div style="flex:1.4">
        <label>ç©å®¶æ‰‹ç‰Œ</label>
        <div id="playerBtns" class="cards" style="margin-top:6px"></div>
        <div class="row" style="margin-top:6px">
          <div id="playerView" class="hand"></div>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn-small" id="undo">å¾©åŸ</button>
          <button class="btn-small" id="clear">æ¸…ç©º</button>
        </div>
      </div>
    </div>

    <div class="sticky-bottom">
      <label>å»ºè­°ç­–ç•¥</label>
      <div id="acts" class="actions"></div>
      <div id="winner" style="margin-top:4px;font-size:18px;font-weight:800">â€”</div>
      <div id="detail" class="ev" style="margin-top:2px;color:var(--muted)"></div>
      <div id="tcDisplay">ç‰Œå€¼ï¼šâ€”ï¼ŒçœŸæ•¸ï¼šâ€”</div>
    </div>
  </div>

  <div class="footer">æ‰‹æ©Ÿç‰ˆ Â· å–®æª” HTMLï¼Œå¯ç›´æ¥éƒ¨ç½²</div>
</div>

<script>
const RANKS = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
function rankVal(r){ return r==='A'?11:(['10','J','Q','K'].includes(r)?10:parseInt(r,10)); }
function makeCardEl(r){ const d=document.createElement('div'); d.className='card'; d.textContent=r; return d; }

let seen = Object.fromEntries(RANKS.map(r=>[r,0]));
let seenHistory = [];
let dealer = null, player = [];

const els = {
  decks: document.getElementById('decks'),
  s17: document.getElementById('s17'),
  das: document.getElementById('das'),
  surrender: document.getElementById('surrender'),
  samples: document.getElementById('samples'),
  seenBtns: document.getElementById('seenBtns'),
  leftCnt: document.getElementById('leftCnt'),
  hiCnt: document.getElementById('hiCnt'),
  dealerBtns: document.getElementById('dealerBtns'),
  dealerView: document.getElementById('dealerView'),
  playerBtns: document.getElementById('playerBtns'),
  playerView: document.getElementById('playerView'),
  undo: document.getElementById('undo'),
  clear: document.getElementById('clear'),
  reset: document.getElementById('reset'),
  undoSeen: document.getElementById('undoSeen'),
  acts: document.getElementById('acts'),
  winner: document.getElementById('winner'),
  detail: document.getElementById('detail'),
  tcDisplay: document.getElementById('tcDisplay')
};

// å»ºç«‹å·²å‡ºç‰ŒæŒ‰éˆ•
function buildSeenButtons(){
  els.seenBtns.innerHTML='';
  RANKS.forEach(r=>{
    const wrap = document.createElement('div'); wrap.className='rank';
    const label = document.createElement('div'); label.textContent=r;
    const cnt = document.createElement('div'); cnt.className='count'; cnt.textContent='x'+seen[r];
    let pressTimer=null,longPressed=false,longMs=600;
    function startPress(ev){ ev.preventDefault(); longPressed=false; pressTimer=setTimeout(()=>{
      if(seen[r]>0){ seen[r]--; removeLastFromHistory(r); cnt.textContent='x'+seen[r]; render(); } longPressed=true;
    },longMs);}
    function endPress(ev){ ev.preventDefault(); clearTimeout(pressTimer); if(!longPressed){ seen[r]++; seenHistory.push(r); cnt.textContent='x'+seen[r]; render(); } longPressed=false;}
    wrap.addEventListener('touchstart',startPress,{passive:false});
    wrap.addEventListener('touchend',endPress);
    wrap.addEventListener('mousedown',startPress);
    wrap.addEventListener('mouseup',endPress);
    wrap.addEventListener('mouseleave',()=>{clearTimeout(pressTimer);longPressed=false;});
    wrap.appendChild(label); wrap.appendChild(cnt); els.seenBtns.appendChild(wrap);
  });
}
function removeLastFromHistory(rank){
  for(let i=seenHistory.length-1;i>=0;i--){ if(seenHistory[i]===rank){ seenHistory.splice(i,1); return; } }
}
function buildPickers(){
  els.dealerBtns.innerHTML=''; els.playerBtns.innerHTML='';
  RANKS.forEach(r=>{
    const b=document.createElement('button'); b.className='rank'; b.textContent=r; b.onclick=()=>{ dealer=r; render(); }; els.dealerBtns.appendChild(b);
    const p=document.createElement('button'); p.className='rank'; p.textContent=r; p.onclick=()=>{ player.push(r); render(); }; els.playerBtns.appendChild(p);
  });
}
els.undoSeen.onclick=()=>{ if(seenHistory.length===0){ alert('æ²’æœ‰å·²å‡ºç‰Œç´€éŒ„å¯æ’¤éŠ·'); return; } const last=seenHistory.pop(); if(seen[last]>0) seen[last]--; buildSeenButtons(); buildPickers(); render(); };
els.reset.onclick=()=>{ RANKS.forEach(r=>seen[r]=0); seenHistory=[]; dealer=null; player=[]; buildSeenButtons(); buildPickers(); render(); };
els.undo.onclick=()=>{ if(player.length>0){ player.pop(); render(); } };
els.clear.onclick=()=>{ player=[]; render(); };

// ===== 21é»ç­–ç•¥è¨ˆç®— =====
const moveCN = {HIT:"è¦ç‰Œ",STAND:"åœç‰Œ",DOUBLE:"åŠ å€",SPLIT:"åˆ†ç‰Œ",SURRENDER:"æŠ•é™",BUST:"çˆ†ç‰Œ"};

function isSoftHand(cards){
  let sum=0, ace=false;
  cards.forEach(c=>{ let v=rankVal(c); sum+=v; if(c==='A') ace=true; });
  return ace && sum<=21;
}

function handValue(cards){
  let sum=0, aces=0;
  cards.forEach(c=>{ let v=rankVal(c); sum+=v; if(c==='A') aces++; });
  while(sum>21 && aces>0){ sum-=10; aces--; }
  return sum;
}

// ä¾åœ–ç‰‡è¡¨æ ¼åšåŸºæœ¬ç­–ç•¥
function calcBestMove(){
  if(!dealer||player.length===0) return {move:'â€”',detail:''};
  let sum=handValue(player);
  let dealerVal=rankVal(dealer);
  let move='HIT',detail='é è¨­è¦ç‰Œ';

  // æŠ•é™
  if(els.surrender.value==='LS'){
    if(player.length===2 && sum===16 && ['9','10','J','Q','K','A'].includes(dealer)) return {move:'SURRENDER',detail:'16 vs é«˜ç‰Œå»ºè­°æŠ•é™'};
    if(player.length===2 && sum===15 && dealer==='10') return {move:'SURRENDER',detail:'15 vs 10 å»ºè­°æŠ•é™'};
  }

  // åˆ†ç‰Œ
  if(player.length===2 && player[0]===player[1]){
    switch(player[0]){
      case 'A': case '8': move='SPLIT'; detail='Aæˆ–8 å»ºè­°åˆ†ç‰Œ'; break;
      case '10': case '5': move='STAND'; detail='10ã€5 ä¸å»ºè­°åˆ†ç‰Œ'; break;
      case '9': if(!['7','10','J','Q','K','A'].includes(dealer)) move='SPLIT'; else move='STAND'; detail='9åˆ†ç‰Œåˆ¤æ–·'; break;
      case '7': if(dealerVal<=7) move='SPLIT'; else move='HIT'; detail='7åˆ†ç‰Œåˆ¤æ–·'; break;
      case '6': if(dealerVal<=6) move='SPLIT'; else move='HIT'; detail='6åˆ†ç‰Œåˆ¤æ–·'; break;
      case '4': if(dealerVal==5||dealerVal==6) move='SPLIT'; else move='HIT'; detail='4åˆ†ç‰Œåˆ¤æ–·'; break;
      case '3': case '2': if(dealerVal<=7) move='SPLIT'; else move='HIT'; detail='2ã€3åˆ†ç‰Œåˆ¤æ–·'; break;
    }
    return {move,detail};
  }

  // è»Ÿç‰ŒåŠ å€
  if(isSoftHand(player)){
    if(sum===19 && dealerVal===6) move='DOUBLE',detail='è»Ÿ19 vs 6 å»ºè­°åŠ å€';
    else if(sum===18 && [2,3,4,5,6].includes(dealerVal)) move='DOUBLE',detail='è»Ÿ18 vs 2-6 å»ºè­°åŠ å€';
    else if(sum>=19) move='STAND',detail='è»Ÿç‰Œ >=19 åœç‰Œ';
    else move='HIT',detail='è»Ÿç‰Œå°æ–¼18 è¦ç‰Œ';
    return {move,detail};
  }

  // ç¡¬ç‰ŒåŠ å€
  if(player.length===2){
    if(sum===11) move='DOUBLE',detail='11 å»ºè­°åŠ å€';
    else if(sum===10 && dealerVal<=9) move='DOUBLE',detail='10 vs 2-9 å»ºè­°åŠ å€';
    else if(sum===9 && [3,4,5,6].includes(dealerVal)) move='DOUBLE',detail='9 vs 3-6 å»ºè­°åŠ å€';
  }

  // ç¡¬ç‰Œæ™®é€šç­–ç•¥
  if(sum>=17) move='STAND',detail='ç¡¬ç‰Œ >=17 åœç‰Œ';
  else if(sum>=13 && sum<=16 && dealerVal<=6) move='STAND',detail='13-16 vs 2-6 åœç‰Œ';
  else if(sum===12 && dealerVal>=4 && dealerVal<=6) move='STAND',detail='12 vs 4-6 åœç‰Œ';
  else move='HIT',detail='å…¶ä»–æƒ…æ³å»ºè­°è¦ç‰Œ';

  return {move,detail};
}

// ===== è¨ˆç®—å‰©é¤˜ç‰Œæ•¸ã€å‰©é¤˜é«˜ç‰Œã€çœŸæ•¸ =====
function calcCount(){
  let count=0,totalSeen=0,highSeen=0;
  for(const r of RANKS){
    if(['2','3','4','5','6'].includes(r)) count+=seen[r];
    else if(['10','J','Q','K','A'].includes(r)) count-=seen[r];
    totalSeen+=seen[r];
    if(['10','J','Q','K','A'].includes(r)) highSeen+=seen[r];
  }
  let totalCards = els.decks.value*52;
  let remaining = totalCards - totalSeen;
  let remainingHigh = els.decks.value*4*5 - highSeen;
  let trueCount = remaining>0? count/(remaining/52) : 0;
  els.leftCnt.textContent = remaining;
  els.hiCnt.textContent = remainingHigh;
  els.tcDisplay.textContent = `ç‰Œå€¼ï¼š${count>=0?'+':''}${count}ï¼ŒçœŸæ•¸ï¼š${trueCount>=0?'+':''}${trueCount.toFixed(2)}`;
  els.tcDisplay.style.color = trueCount>0? 'var(--good)':(trueCount<0?'var(--bad)':'var(--muted)');
}

function render(){
  buildSeenButtons();
  buildPickers();
  els.playerView.innerHTML=''; player.forEach(r=>els.playerView.appendChild(makeCardEl(r)));
  els.dealerView.innerHTML=''; if(dealer) els.dealerView.appendChild(makeCardEl(dealer));
  const best=calcBestMove();
  els.winner.textContent = `${moveCN[best.move]} (${best.move})`;
  els.detail.textContent = best.detail;
  calcCount();
}
render();
</script>
</body>
</html>


